<div class="post" *ngIf="(post$ | async) as post; else loadingTemplate">

    <div class="media" *ngIf="post.imgUrl || post.videoUrl">
        <img *ngIf="post.imgUrl" src="{{post.imgUrl}}" alt="mainPostPicture">
        <video *ngIf="post.videoUrl" controls>
            <source src="{{post.videoUrl}}" type="video/mp4">
            Dreams does not support the video tag.
        </video>
    </div>

    <ng-container *ngIf="(user$ | async) as user;  else wrongUserTemplate">
        <p [routerLink]='["../../user", user.id]' class="username">U/{{user.username}}</p>
    </ng-container>
    <ng-template #wrongUserTemplate>
        <p class="username">U/unknown</p>
    </ng-template>
    <h2>{{post.title}}</h2>
    <a routerLink="update" class="btn btn-primary">Edit</a>
    <hr>

    <div [innerHTML]="post.content"></div>
    <hr>

    <div *ngIf="post.reactions && post.reactions.length > 0">
        <h4>Reactions:</h4>
        <ul>
          <ng-template #reactionTemplate let-reactions>
            <li *ngFor="let reaction of reactions">
              <p>Positive Vote: {{ reaction.isPositiveVote ? 'Yes' : 'No' }}</p>
              <p>Context: {{ reaction.Context }}</p>
              <p>Reaction Date: {{ reaction.ReactionDate | date }}</p>
              <!-- Recursively render nested reactions -->
              <ng-container *ngIf="reaction.reactions && reaction.reactions.length > 0">
                <ul>
                  <ng-container *ngTemplateOutlet="reactionTemplate; context:{ $implicit: reaction.reactions }"></ng-container>
                </ul>
              </ng-container>
            </li>
          </ng-template>
          <!-- Render top-level reactions -->
          <ng-container *ngTemplateOutlet="reactionTemplate; context:{ $implicit: post.reactions }"></ng-container>
        </ul>
      </div>
      <div *ngIf="!post.reactions || post.reactions.length === 0">
        <p>No reactions here.</p>
      </div>
    
</div>
<ng-template #loadingTemplate>
    <h2>Loading...</h2>
</ng-template>
